## 经典蓝牙概述

### 概述

使用Qt蓝牙API的典型用例是：

* 检索有关本地蓝牙设备的信息。
* 扫描范围内的其他蓝牙设备，并获取有关它们的信息。
* 使用OBEX对象推送配置文件（OPP）将文件推送到远程设备
* 使用串行端口配置文件（SPP）通过RFCOMM通道连接到远程设备。
* 创建一个RFCOMM服务器，该服务器允许使用SPP进行传入连接。
* 检索有关低功耗蓝牙设备的规范。
* 连接到低功耗蓝牙设备。
* 从低功耗蓝牙设备接收广告。

请注意，Android和Windows不支持对象推送配置文件。

注意： Windows上的Qt无法配置RFCOMM功能的某些部分。服务的ServiceClassIds和ProtocolDescriptorList会自动填充。因此，使用这些字段的自定义值注册服务可能不会在Windows上产生预期的结果。

注意： Win32后端不支持接收信号强度指示器（RSSI）以及Bluetooth LE设备通告的制造商特定数据。另外，只能找到以前通过Windows设置进行配对的设备。

以下各节描述了如何在上述用例中使用Qt Bluetooth C ++ API类。

### 检索本地设备信息

Qt蓝牙API具有三个主要目的。第一个是获取本地和远程设备信息。检索设备信息的第一步是检查设备上是否有蓝牙，并读取本地设备的地址和名称。QBluetoothLocalDevice是提供所有这些信息的类。另外，您可以使用它来打开/关闭蓝牙，设置设备的可见性并确定当前连接。

```c++
QBluetoothLocalDevice localDevice;
QString localDeviceName;

//检查蓝牙是否可用
if(localDevice.isValid()) {
    //打开
    localDevice.powerOn();
    //读取本地设备名称
    localDeviceName = localDevice.name();
    //使其他人可以看到它
    localDevice.setHostMode(QBluetoothLocalDevice::HostDiscoverable);
    //获取连接的设备
    QList<QBluetoothAddress> remotes;
    remotes = localDevice.connectedDevices();
}
```

### 扫描蓝牙设备

与QBluetoothLocalDevice相似，API提供了QBluetoothDeviceInfo，它为远程设备提供了类似的信息。尽管您可以自己创建QBluetoothDeviceInfo对象并用数据填充它们，但更简单的方法是使用QBluetoothDeviceDiscoveryAgent开始在可连接范围内自动搜索可见的蓝牙设备。

```c++
void MyClass::startDeviceDiscovery()
{

    //创建发现代理并连接到其信号
    QBluetoothDeviceDiscoveryAgent *discoveryAgent = new QBluetoothDeviceDiscoveryAgent(this);
    connect(discoveryAgent, SIGNAL(deviceDiscovered(QBluetoothDeviceInfo)),
            this, SLOT(deviceDiscovered(QBluetoothDeviceInfo)));

    //开始发现
    discoveryAgent->start();

    //...
}

//在您的本地插槽中，读取有关找到的设备的信息
void MyClass::deviceDiscovered(const QBluetoothDeviceInfo &device)
{
    qDebug() << "Found new device:" << device.name() << '(' << device.address().toString() << ')';
}

```
